% !TeX spellcheck = de_DE
\documentclass[DIV=12]{scrartcl}
\setkomafont{sectioning}{\normalfont\bfseries\boldmath}

\usepackage{geometry}

\usepackage[british, main=ngerman]{babel}
\usepackage{xcolor}
\usepackage{tikz}

%\ifdefined\directlua
%	\edef\pdfcompresslevel{\pdfvariable compresslevel}
%	\edef\pdfobjcompresslevel{\pdfvariable objcompresslevel}
%\fi
%\ifdefined\pdfcompresslevel
%	\pdfcompresslevel=0
%	\pdfobjcompresslevel=0
%\else
%	\special{dvipdfmx:config z 0}
%\fi

\setlength\parindent{0pt}
\setlength\parfillskip{1em plus 1fil}
\setlength\parskip{0pt}

%\usepackage{fontspec}
%\setmainfont{Linux Libertine O}
%\setsansfont{Linux Biolinum O}
\newcommand\hugefont[1]{\raisebox{-5pt}{\fontsize{50}{60}\sffamily\bfseries\selectfont #1}}
\newcommand\hugemathfont[1]{{\fontsize{40}{48}\sffamily\bfseries\selectfont #1}}
\newcommand\biggerfont[1]{{\fontsize{30}{36}\sffamily\bfseries\selectfont #1}}
\newcommand\bigfont[1]{{\fontsize{20}{24}\sffamily\bfseries\selectfont #1}}
%\newcommand\textfontsize[1]{\fontsize{10}{12}\sffamily\selectfont #1}
\newcommand\textfontsize[1]{\fontsize{9}{10}\sffamily\selectfont #1}

\newcommand\rede[1]{\glqq #1\grqq{}}
\newcommand\textrule[1]{\textbf{#1}}
\newcommand\Item{$\bullet$\kern0.333em}

\newdimen\cardwidth
\cardwidth=60mm
\newdimen\cardheight
\cardheight=90mm
\newdimen\cardborder
\cardborder=5mm
\newdimen\cardtextwidth
\cardtextwidth=\cardwidth
\advance\cardtextwidth by -2.75\cardborder
\newdimen\cardlinewidth
\cardlinewidth=0.4pt

\newcount\cardnum
\cardnum=0
\newcount\auxnum
\newcommand\CardBack[1][green!20]{%
  \advance\cardnum by 1%
  \begin{tikzpicture}
%	\draw[line width=\cardlinewidth, rounded corners=5mm] (0,0) rectangle (\cardwidth,\cardheight) coordinate (URex);
	\path (0,0)--(\cardwidth,\cardheight) coordinate[midway] (Center);
	\path (URex)--+(-\cardborder,-\cardborder) coordinate (UR);
	\fill[#1, rounded corners=\cardborder] (\cardborder,\cardborder) coordinate (LL) rectangle (UR);
    \node at (Center) {\hugefont{git}};
  \end{tikzpicture}%
  \ifnum\cardnum>2
  	\cardnum=0
  
  	\vskip-1pt
  \fi
}
\newenvironment{CardFront}[1]{%
  \global\advance\cardnum by 1%
  \begin{tikzpicture}
  	% Schnittrahmen
    \draw[line width=\cardlinewidth, rounded corners=5mm] (0,0) rectangle (\cardwidth,\cardheight) coordinate (URex);

    \path (0,0)--(\cardwidth,\cardheight) coordinate[midway] (Center);
    \path (URex)--+(-\cardborder,-\cardborder) coordinate[midway] (URmed) coordinate (UR);
    \coordinate (ULex) at (0,\cardheight);
    
    % innerer Rahmen
    \fill[bgcolor, rounded corners=\cardborder] (\cardborder,\cardborder) coordinate (LL) rectangle (UR);
    
    \path (LL)|-(UR) coordinate[midway] (UL);
    \path (UL)--(ULex) coordinate[midway] (ULmed);
    \path (LL)-|(UR) coordinate[midway] (LR);

    \path (Center)+(0,0.075\cardheight) coordinate (UCenter);
	
	% Überschrift
	\path (UCenter)+(0,0.25\cardheight) node {\bigfont{#1}};
}{
  \end{tikzpicture}%
  \ifnum\cardnum>2
	\global\cardnum=0

	\vskip-1pt
  \fi
}
\colorlet{bgcolor}{gray!20}
\colorlet{bgcolor2}{orange!25} % niedrige CRs
\colorlet{bgcolor3}{red!20}% hohe CRs
\colorlet{bg-green}{green!65}
\colorlet{bg-yellow}{yellow!75}
\definecolor{bg-blue}{rgb}{0,0.5,1}
\colorlet{paleblue}{cyan!35}
\colorlet{errorcolor}{red!75}
\colorlet{warncolor}{orange!75}
\colorlet{nullcolor}{bg-yellow}
\colorlet{middlecolor}{bg-green}
\colorlet{highcolor}{bg-blue}
\newcommand\CardTextField[1]{% Text
    \path (UCenter)+(0,-0.25\cardwidth-0.015\cardheight) node[anchor=north] {%
	\begin{minipage}{\cardtextwidth}
		\textfontsize\rightskip0pt minus 0.25em
		#1
	\end{minipage}};
}
\newcommand\CardFrontTikzBase[3]{% Überschrift, Tikz-Graphik, Text
	\begin{CardFront}{#1}
		% Tikz-Graphik
		#2
		
		% Textbereich
		\CardTextField{#3}
	\end{CardFront}%
}
\newcommand\CardFrontTikzCircle[4]{% Überschrift, Tikz-Graphik, Farbe, Text
	\CardFrontTikzBase{#1}{%
%		\draw[line width=1.5pt] (UCenter)+(-0.45\cardwidth,0)--+(0.45\cardwidth,0);
		\draw[line width=1.5pt, fill=#3] (UCenter) circle[radius=0.25*\cardwidth];
		#2}{#4}%
}
\newcommand\CardFrontTikzBox[5][0.25\cardwidth]{% halbe Breite, Überschrift, Tikz-Graphik, Farbe, Text
	\CardFrontTikzBase{#2}{%
		\draw[line width=1.5pt, rounded corners, fill=#4] (UCenter)++(-#1,-0.2\cardwidth) rectangle ++(2*#1,0.4\cardwidth);
		#3}{#5}%
}
\newcommand\CalcNumberColor[1]{% Zahlwert
	\ifnum#1<0
		\colorlet{numcolor}{errorcolor}%
	\else%
		\ifnum#1<8%
			\auxnum=#1
			\ifnum#1=0\else\advance\auxnum by -1\fi%
			\multiply\auxnum by 14
			\colorlet{numcolor}{middlecolor!\the\auxnum!nullcolor}%
		\else%
			\ifnum#1<32
				\auxnum=#1
				\advance\auxnum by -8
				\multiply\auxnum by 42
				\divide\auxnum by 10
				\colorlet{numcolor}{highcolor!\the\auxnum!middlecolor}%
			\else%
				\colorlet{numcolor}{highcolor}%
			\fi%
		\fi%
	\fi%
%
	\auxnum=#1
	\ifnum\auxnum<0\else%
		\ifnum\auxnum<16
			\def\sixteen{white}%
		\else%
			\def\sixteen{black}%
			\advance\auxnum by -16
		\fi%
		\ifnum\auxnum<8
			\def\eight{white}%
		\else%
			\def\eight{black}%
			\advance\auxnum by -8
		\fi%
		\ifnum\auxnum<4
			\def\four{white}%
		\else%
			\def\four{black}%
			\advance\auxnum by -4
		\fi%
		\ifnum\auxnum<2
			\def\two{white}%
		\else%
			\def\two{black}%
			\advance\auxnum by -2
		\fi%
		\ifnum\auxnum<1%
			\def\one{white}%
		\else%
			\def\one{black}%
		\fi%
	\fi%
	\auxnum=#1
}
\newcommand\DrawNumber{
	\ifnum\auxnum<0
		\path (UCenter)+(0,0.025\cardwidth) node[anchor=center] {\hugefont{X}};
	\else
		\path (UCenter)+(0,0.025\cardwidth) node[anchor=center] {\hugefont{\number\auxnum}};
		\ifnum\auxnum<16
			\path (UCenter)++(-0.09*\cardwidth,-0.125*\cardwidth) coordinate (aux);
		\else
			\path (UCenter)++(-0.12*\cardwidth,-0.125*\cardwidth) coordinate (aux);
			\draw[fill=\sixteen] (aux) circle[radius=1mm];
			\path (aux)++(0.06*\cardwidth,0) coordinate (aux);
		\fi
		\draw[fill=\eight] (aux) circle[radius=1mm];
		\path (aux)++(0.06*\cardwidth,0) coordinate (aux);
		\draw[fill=\four] (aux) circle[radius=1mm];
		\path (aux)++(0.06*\cardwidth,0) coordinate (aux);
		\draw[fill=\two] (aux) circle[radius=1mm];
		\path (aux)++(0.06*\cardwidth,0) coordinate (aux);
		\draw[fill=\one] (aux) circle[radius=1mm];
	\fi
}
\newcommand\DrawNumberBorder{%
	\ifnum\auxnum>0%\else
		\node[draw, line width=1pt, fill=numcolor, circle, inner sep=0pt, anchor=north west] at (ULmed) {\hphantom{\bigfont{0}}\clap{\bigfont{\number\auxnum}}\hphantom{\bigfont{0}}};%
		\node[draw, line width=1pt, fill=numcolor, circle, inner sep=0pt, anchor=north east] at (URmed) {\hphantom{\bigfont{0}}\clap{\bigfont{\number\auxnum}}\hphantom{\bigfont{0}}};%
	\fi
}
\newcommand\CardFrontCommit[2][\centering\rede{git push!}]{% Text, Zahlwert
	\CalcNumberColor{#2}%
	\CardFrontTikzCircle{commit}{\DrawNumber\DrawNumberBorder}{numcolor}{#1}%
}
\newcommand\CardFrontCommitPlus[4][\centering\rede{git push!}]{% Text, Zahlwert, Symbol, Farbe
	\CalcNumberColor{#2}%
	\CardFrontTikzCircle{commit}{\DrawNumber\DrawNumberBorder %
		\draw[line width=1.25pt, rounded corners, fill=#4] (UCenter)++(30:0.275\cardwidth) coordinate (c)++(-90:0.0866\cardwidth)--++(0:0.15\cardwidth)--++(120:0.3\cardwidth)--++(-120:0.3\cardwidth)--cycle;
		\node[anchor=center] at (c) {\biggerfont{#3}};
	}{numcolor}{#1}%
}
\newcommand\CardFrontSign[4]{% Überschrift, Zeichen, Farbe, Text
	\CardFrontTikzBox{#1}{%
		\path (UCenter) node[anchor=center] {\hugefont{#2}};
	}{#3}{#4}%
}

\newcommand\CardRelease{%
	\CardFrontTikzBase{release}{%
		\path (UCenter)++(-0.075\cardwidth,0) coordinate (center);
		\draw[rounded corners, line width=1.5pt, fill=orange] (center)++(-0.2\cardwidth,-0.175\cardwidth)--++(0.4\cardwidth,0)--++(0.175\cardwidth,0.175\cardwidth)--++(-0.175\cardwidth,0.175\cardwidth)--++(-0.4\cardwidth,0)--cycle;
		\draw[line width=1.5pt, fill=bgcolor] (center)+(0.25\cardwidth,0) circle[radius=3mm];
		\node at (center) {\bigfont{v\,1.x}};
	}{%
	\centerline{\rede{git tag .\,.\,. und Lieferung!}}\vskip0.5ex
%	Ich beschließe, dass der aktuelle Stand ausgeliefert wird:
	\Item Falls das Ziel erreicht ist, wertet alle Karten im Repo.\ aus und legt sie sowie die aktuellen Issues und alle Handkarten auf den Abwurfstapel.\\
	\Item Leg diese Karte auf den Abwurfstapel und ziehe einen neuen CR.}%
}
\newcommand\CardRevert{%
	\CardFrontTikzBox{revert}{%
		\begin{scope}[line width=2pt]
			\path (UCenter)--+(0.05\cardwidth,0.075\cardheight) coordinate (aux);
			\node[draw, fill=gray, circle, radius=1.5mm]  (A) at (aux) {};
			\path (UCenter)--+(0.05\cardwidth,-0.075\cardheight) coordinate (aux);
			\node[draw, fill=gray, circle, radius=1.5mm]  (B) at (aux) {};
			\draw (A)--(B);
			\draw[->] (A)..controls +(-0.2\cardwidth,0) and +(-0.2\cardwidth,0)..(B);
		\end{scope}
	}{warncolor}{%
		\centerline{\rede{git revert!}}\vskip1ex
		Der gerade geschriebene Code ist fehlerhaft und muss wieder weg:\vskip0.5ex
		\Item Muss unmittelbar auf eine Zahlkarte folgen und negiert sie.\\
		\Item Leg beide Karten auf den Abwurfstapel.}%
}
\newcommand\CardMergeConflict[1]{% Zahlwert
	\CardFrontCommitPlus[%
		\centerline{\rede{git push -- merge conflict!}}\vskip1ex
		Mit diesem Commit verursachst und löst du einen Merge Conflict:\vskip0.5ex
		\Item Übernimm den vorherigen Commit als deinen eigenen, leg ihn unter diese Karte. Diese beiden Commits gelten ab jetzt als einer.]{#1}{!}{bg-yellow}%
}
\newcommand\CardMergeRequest[1]{% Zahlwert
	\CardFrontCommitPlus[%
		\centerline{\rede{git push -- merge request!}}\vskip1ex
		Mit diesem Commit \textit{bittest} du deinen Kollegen um ein Code Review, dass er natürlich auch durchführt:\vskip0.5ex
		\Item Der nächsten Spieler muss einmal aussetzen.]{#1}{?}{paleblue}%
}
\newcommand\CardIssue[2][CR]{% Zusatz, Zahlwert
	\CalcNumberColor{#2}%
	\CardFrontTikzBox{Issue: #1}{\DrawNumber}{numcolor}{%
		\Item Für diese Lieferung müssen mindestens #2~Codezeilen erreicht werden.\\
		\auxnum=#2 %
		\divide\auxnum by 2 %
		\Item Bei der Lieferung erhält der Auslieferer \number\auxnum~Zusatzpunkte.}%
}
\newcommand\CardBug[2][0.25\cardwidth]{% halbe Breite, Zahlwert
	\CardFrontTikzBox[#1]{Issue: Bug}{%
		\node at (UCenter) {\hugemathfont{+}\!\hugefont{#2}};
		}{errorcolor}{%
		\rede{Ich habe einen Fehler gefunden, der auch noch behoben werden muss.}\vskip0.5ex
		\Item Leg die Karte zum aktuellen CR.\\
		\Item Für die aktuelle Lieferung müssen noch #2~Codezeilen zusätzlich erreicht werden.}%
}

\begin{document}
Ein Test für Sonderzeichen: ÄÖÜ äöü ß.

\vfill
Es folgen die Seiten mit den Karten zum Ausdrucken.
\newdimen\auxdim
\auxdim=3\cardwidth
\advance\auxdim by 3\cardlinewidth
\newgeometry{top=10mm,bottom=10mm,textwidth=\auxdim}

\CardFrontCommit{1}%
\CardFrontCommit{2}%
\CardFrontCommit{3}%
\CardFrontCommit{4}%
\CardFrontCommit{5}%
\CardFrontCommit{6}%
\CardFrontCommit{7}%
\CardFrontCommit{8}%
\CardFrontCommit{9}%

%\newgeometry{top=10mm,bottom=10mm,textwidth=3\cardwidth}
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%



\CardFrontCommit{10}%
\CardFrontCommit{12}%
\CardFrontCommitPlus[%
\centerline{\rede{git push -- refactoring!}}\vskip1ex
	%todo%Mit diesem Commit verursachst und löst du einen Merge Conflict:\vskip0.5ex
	\Item Übernimm die vorherigen drei Commits als deine eigenen, leg die Karten unter diese. Alle diese Commits gelten ab jetzt als einer.]{0}{!}{errorcolor}%
\CardMergeConflict{2}%
\CardMergeConflict{3}%
\CardMergeConflict{4}%
\CardMergeRequest{2}%
\CardMergeRequest{3}%
\CardMergeRequest{4}%

\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%



\CardRevert%
\CardRevert%
\CardRevert%
\CardFrontSign{help}{?}{bg-green}{%
	\centerline{\rede{git help!}}\vskip1ex
	Du weißt gerade nicht weiter und brauchst Hilfe:\vskip0.5ex
	\Item Leg diese Karte auf den Abwurfstapel.\\
	\Item Zieh drei Handkarten zusätzlich, nachdem du \textrule{aufgestockt} hast.}%
\CardFrontSign{status}{?}{bg-yellow}{%
	\centerline{\rede{git status!}}\vskip1ex
	Du hast gerade keine Idee und brauchst erstmal einen Überblick:\vskip0.5ex
	\Item Leg diese Karte auf den Abwurfstapel.\\
	\Item Zieh eine Handkarte zusätzlich, nachdem du \textrule{aufgestockt} hast.}%
\CardFrontTikzBox{stash}{%
	\begin{scope}[line width=2pt]
		\draw[fill=gray] (UCenter)+(-0.15\cardwidth,0) rectangle +(0.15\cardwidth,-0.075\cardheight);
		\draw[-latex, line width=3pt] (UCenter)+(0,0.1\cardheight)--(UCenter);
	\end{scope}
	}{magenta!65}{%
	\centerline{\rede{git stash!}}\vskip1ex
	\Item Leg bis zu zwei Handkarten vor Dir ab.\\
	\Item Diese können weiterhin wie Handkarten ausgespielt werden, gehen aber bei einem Release nicht verloren.}%
\CardFrontTikzBase{cherry-pick}{%
		% Stiel
		\draw[line width=3pt,green!50!black] (Center)..controls+(0,0.3\cardwidth)..+(0.2\cardwidth,0.35\cardwidth) coordinate[pos=0.8] (aux);
		% Blatt
%		\fill (aux)--+()
		% Frucht
		\shade[ball color=red!80!blue] (Center) circle[radius=0.1\cardwidth];
%		\fill[red!80!blue] (Center) circle[radius=0.1\cardwidth];
	}{%
	\centerline{\rede{git cherry-pick!}}\vskip1ex
	\Item \textrule{Stocke} zuerst deine Handkarten auf.\\
	\Item Wähle dir danach bei einem beliebigen Spieler aus seinen Handkarten eine aus und füge sie deinen hinzu oder spiele sie sofort aus.}%
\CardFrontTikzBox{}{}{white}{todo}%
\CardFrontTikzBox{}{}{white}{todo}%

\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%



\CardRelease%
\CardRelease%
\CardRelease%
\CardRelease%
\CardRelease%
\CardBug{5}%
\CardBug{7}%
\CardBug{8}%
\CardBug[0.275\cardwidth]{10}%

\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%
\CardBack%



\CardIssue{10}%
\CardIssue{12}%
\CardIssue{15}%
\CardIssue{16}%
\CardIssue{20}%
\CardIssue{24}%
\CardIssue{26}%
\CardIssue{30}%
\CardIssue{32}%

\CardBack[bgcolor2]%
\CardBack[bgcolor2]%
\CardBack[bgcolor2]%
\CardBack[bgcolor2]%
\CardBack[bgcolor2]%
\CardBack[bgcolor2]%
\CardBack[bgcolor2]%[bgcolor3]%
\CardBack[bgcolor2]%[bgcolor3]%
\CardBack[bgcolor2]%[bgcolor3]%

\end{document}
